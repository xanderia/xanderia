<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>Shop Playground</title>

		<link rel="manifest" href="/shop-playground/manifest.json"/>
		<link rel="apple-touch-icon" sizes="180x180" href="/shop-playground/apple-touch-icon.png"/>
		<link rel="apple-touch-startup-image" href="/shop-playground/apple-touch-icon.png"/>
		<link rel="mask-icon" href="" color=""/>

		<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,maximum-scale=1,minimum-scale=1">
		<meta name="description" content="A Neat Expo App">
		<meta name="theme-color" content="#000000">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="default">
		<meta name="apple-mobile-web-app-title" content="Shop Playground">
		<meta name="application-name" content="Shop Playground">
		<meta name="msapplication-navbutton-color" content="#000000">
		<meta name="msapplication-TileColor" content="">
		<meta name="msapplication-TileImage" content="">

		<style>
			body,html {
				height:			100%;
				margin:			0;
				padding:		0;
				font-family:	"Helvetica Neue", sans-serif;
			}

			#app-area {
				display:			flex;
				flex-direction:		column;
				width:				100%;
				height:				100%;
				margin:				0;
				padding:			0;
				background-color:	#323232;

			}

			#main-area {
				width:				100%;
				max-width:			800px;
				height:				100%;
				margin-left:		auto;
				margin-right:		auto;
				padding-top:		30px;
				/* padding-left:		20px; */
				/* padding-right:		20px; */
				background-color:	white;
			}

			#header-area {
				width: 50%;
				min-width: 300px;
				margin-left: auto;
				margin-right: auto;
				margin-bottom: 40px;
			}

			#header {
				font-size: 40px;
				font-weight: 200;
				color: #333333;
				text-align: center;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			#load-paypal-area {
			    width: 50%;
			    min-width: 300px;
			    margin-left: auto;
			    margin-right: auto;
			    margin-bottom: 20px;
			    display: flex;
			    flex-direction: row;
			    justify-content: space-between;
			    align-items: stretch;
			    height: 35px;
			    border: none;
			}

			.load-paypal-button {
			    font-size: 14px;
			    color: white;
			    border: none;
			    outline: none;
				border-radius: 1px;
				transition: background-color 100ms ease-in-out;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			#load-paypal-button-automatically {
				flex: 3;
				background-color: rgb(23, 167, 25);
				margin-right: 5px;
			}
			#load-paypal-button-automatically:hover {
				background-color: rgb(43, 193, 45);
			}
			#load-paypal-button-automatically:active {
				background-color: rgb(79, 223, 81);
			}

			#load-paypal-button-manually {
				flex: 1;
				background-color: rgb(110, 173, 30);
			}
			#load-paypal-button-manually:hover {
				background-color: rgb(132, 194, 54);
			}
			#load-paypal-button-manually:active {
				background-color: rgb(171, 238, 86);
			}

			#orchestration-button-container {
				display:			flex;
				flex-direction:		column;
				justify-content:	space-around;
				width:				50%;
				min-width:			300px;
				margin-left:		auto;
				margin-right:		auto;
			}

			.orchestration-button {
				height:				35px;
				margin-bottom:		3px;
				font-size:			14px;
				padding-left:		20px;
				text-align:			left;
				background-color:	#efefef;
				transition:			background-color 100ms ease-in-out;
				border:				none;
				border-radius:		1px;
				color:				black;
				outline:			none;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			.orchestration-button:hover {
				background-color:	#f4f4f4;
			}
			.orchestration-button:active {
				background-color:	#f8f8f8;
			}

			#orchestration-button-select-payment-option {
				color:				#909090;
			}

			#paypal-ucc-area {
				margin-top: 50px;
				width: 50%;
				min-width: 300px;
				margin-left: auto;
				margin-right: auto;
			}

			#paypal-ucc-labels {
				display: flex;
				flex-direction: row;
				flex-wrap: no-wrap;
				justify-content: space-between;
				align-items: stretch;
				align-content: stretch;
			}

			.paypal-ucc-label {
				font-family: 'Helvetica Neue', sans-serif;
				font-size: 12px;
				color: lightslategray;
				margin-bottom: 2px;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			#paypal-ucc-label-card-number {
				flex: 2;
				margin-right: 5px;
			}

			#paypal-ucc-label-expiration-date {
				flex: 1;
				margin-right: 5px;
			}

			#paypal-ucc-label-cvv {
				flex: 1;
				margin-right: 0px;
			}

			#paypal-ucc-field-area {
				display: flex;
				flex-direction: row;
				flex-wrap: no-wrap;
				justify-content: space-between;
				align-items: stretch;
				align-content: stretch;
			}

			.paypal-ucc-field {
				height: 20px;
				border: 1px solid lightslategray;
				padding: 3px 8px;
			}

			#paypal-ucc-card-number {
				flex: 2;
				margin-right: 5px;
			}

			#paypal-ucc-expiration-date {
				flex: 1;
				margin-right: 5px;
			}

			#paypal-ucc-cvv {
				flex: 1;
				margin-right: 0px;
			}

			#paypal-ucc-submit-area {
			}

			#paypal-ucc-submit {
				height: 50px;
				margin-top: 15px;
				font-size: 17px;
				width: 100%;
				background-color: #2C2E2F;
				transition:			background-color 100ms ease-in-out;
				border: none;
				border-radius: 4px;
				color: white;
				outline: none;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			#paypal-ucc-submit:hover {
				background-color: #494a4a;
			}
			#paypal-ucc-submit:active {
				background-color: #5b5b5b;
			}

			#paypal-sdk-area {
				margin-top: 15px;
				width: 50%;
				min-width: 300px;
				min-height: 200px;
				background-color: transparent;
				margin-left: auto;
				margin-right: auto;
			}
		</style>

	</head>

	<body>

		<div id="app-area">
			<div id="main-area">
				<div id="header-area">
					<h1 id="header">Shop Playground</h1>
				</div>

				<!--
				<div id="load-paypal-area">
					<button type="button" class="load-paypal-button" id="load-paypal-button-automatically">Load PayPal Area</button>
					<button type="button" class="load-paypal-button" id="load-paypal-button-manually">manually</button>
				</div>
				-->

				<div id="orchestration-button-container">
					<button type="button" class="orchestration-button" id="orchestration-button-client-token">1. Retrieve UCC Client Token</button>
					<button type="button" class="orchestration-button" id="orchestration-button-create-order">2. Create Order</button>
					<button type="button" class="orchestration-button" id="orchestration-button-load-paypal-sdk-script">3. Load PayPal SDK Script</button>
					<button type="button" class="orchestration-button" id="orchestration-button-render-paypal-sdk">4. Render PayPal SDK</button>
					<button type="button" class="orchestration-button" id="orchestration-button-render-paypal-ucc">5. Render PayPal UCC Area</button>
					<button type="button" class="orchestration-button" id="orchestration-button-activate-paypal-buttons">6. Activate PayPal Buttons</button>
					<button type="button" class="orchestration-button" id="orchestration-button-select-payment-option" disabled="disabled">7. Select payment option in PayPal SDK</button>
					<button type="button" class="orchestration-button" id="orchestration-button-finalize-order">8. Finalize Order</button>
					<!-- <button type="button" class="orchestration-button" id="orchestration-button-refund-capture">9. Refund Capture</button> -->
				</div>

				<div id="paypal-ucc-area">
					<form id="paypal-ucc-form">
						<div id="paypal-ucc-labels">
							<label for="paypal-ucc-card-number"		class="paypal-ucc-label"	id="paypal-ucc-label-card-number">Credit Card Number</label>
							<label for="paypal-ucc-expiration-date"	class="paypal-ucc-label"	id="paypal-ucc-label-expiration-date">Expiration</label>
							<label for="paypal-ucc-cvv"				class="paypal-ucc-label"	id="paypal-ucc-label-cvv">CVV</label>
						</div>

						<div id="paypal-ucc-field-area">
							<div class="paypal-ucc-field"	id="paypal-ucc-card-number"></div>
							<div class="paypal-ucc-field"	id="paypal-ucc-expiration-date"></div>
							<div class="paypal-ucc-field"	id="paypal-ucc-cvv"></div>
						</div>

						<div id="paypal-ucc-submit-area">
							<button type="submit" id="paypal-ucc-submit">Pay with Credit Card</button>
						</div>
					</form>
				</div>



				<div id="paypal-sdk-area">
					<div id="paypal-sdk-container">
					</div>
				</div>

			</div>
		</div>

		<script><!--

			let app = {
				paypal: {
					clientId:				"AVX6tQmhr7LIZfYA0HBVAn9RpmPB88Mcz_ozS73farX-5e4W3FdY0P4fOwkhgadI99788JdGnpjKjLf_",
					merchantId:				"NBERV38QP8R5Q",
					clientToken:			null,
					orderId:				null,
					paymentAreaRendered:	false,
					SDKButtonActions:		null,

					states: {
						initial:			false,
						UCCClientToken:		false,
						orderId:			false,
						script:				false,
						paypalRendered:		false,
						uccRendered:		false,
						activated:			false
					},

					apiCallLogs: {
						accessToken:		{},
						uccClientToken:		{},
						order:				{},
						SDKscript:			{},
						render:				{},
						onAuthorize:		{},
						finalize:			{},
						webhook:			{},
						refund:				{},
						refundWebhook:		{}
					}
				}
			};


			app.paypal.changeState = _ => {
				let f = "app.paypal.changeState";

				switch (_) {

					case 'initial':
						break;

					case 'UCCClientToken':
						if (app.paypal.states.UCCClientToken && app.paypal.states.orderId) {
							// TODO load script
						}
						break;

					case 'orderId':
						if (app.paypal.states.UCCClientToken && app.paypal.states.orderId) {
							// TODO load script
						}
						break;

					case 'script':
						// TODO load both paypalRender and UCCRender simultaneously
						break;

					case 'paypalRendered':
						break;

					case 'uccRendered':
						break;

					case 'activated':
						break;

					default:
						console.log(f + ": Invalid state name: ", _);
						break;
				}
			};



			app.paypal.retrieveUCCClientToken = _ => {
				let f = "app.paypal.retrieveUCCClientToken";
				console.log(f + ": Retrieving UCC Client Token ...");

				fetch("https://xanderia.one/paypal-ucc-client-token")
				.then(_ => _.json())
				.then(_ => {
					app.paypal.clientToken = _.client_token;
					console.log(f + ": UCC Client Token retrieved: " + _.client_token.substring( 0, 10 ) + "___" + _.client_token.substring( _.client_token.length - 10, _.client_token.length ));
				})
				.catch(_ => { console.log(f + ": Failed to retrieve UCC Client Token: " + _); console.groupEnd(); });
			};
			document.getElementById("orchestration-button-client-token").addEventListener('click', app.paypal.retrieveUCCClientToken);



			app.paypal.retrieveOrderId = _ => {
				let f = "app.paypal.retrieveOrderId";
				console.log(f + ": Retrieving Order ID ...");

				fetch("https://xanderia.one/paypal-order-create")
				.then(_ => _.json())
				.then(_ => {
					app.paypal.orderId = _.id;
					console.log(f + ": Retrieved Order Id: " + _.id);
				})
				.catch(_ => { console.log(f + ": Failed to retrieve Order Id: " + _); console.groupEnd(); });
			};
			document.getElementById("orchestration-button-create-order").addEventListener('click', app.paypal.retrieveOrderId);



			app.paypal.loadSDKScript = _ => {
				let f = 'app.paypal.loadSDKScript';
				let sdkNode = document.createElement("script");
				let srcAttribute = 'https://www.paypal.com/sdk/js?client-id=' + _.clientId + '&merchant-id=' + _.merchantId + '&currency=' + _.currency + '&intent=' + _.intent + '&commit=' + _.commit + '&components=' + _.components + '&locale=' + _.locale /* + '&disable-funding=' + _['disable-funding'] */;

				sdkNode.setAttribute("type", "text/javascript");
				sdkNode.setAttribute("data-client-token", _.clientToken);
				sdkNode.setAttribute("src", srcAttribute);
				sdkNode.setAttribute("onload", "javascript:app.paypal.onSDKLoaded()");

				document.getElementById('paypal-sdk-script-container').appendChild(sdkNode);

				console.log(f + ": Loading PayPal SDK ...", {srcAttribute: srcAttribute});
			};

			app.paypal.loadSDKScriptDefault = _ => new Promise(async (resolve, reject) => {
				app.paypal.loadSDKScript({
					clientToken:	app.paypal.clientToken,
					clientId:		app.paypal.clientId,
					merchantId:		app.paypal.merchantId,
					intent:			"capture",
					currency:		"EUR",
					commit:			"true",
					components:		"buttons,hosted-fields",
					locale:			"en_DE"							// NOTE https://developer.paypal.com/docs/checkout/reference/customize-sdk/#locale
					// disable-funding = credit,card,sepa
					// disable-card=visa,mastercard,amex,discover,jcb,elo,hiper
					// integration-date=2019-04-03
					// debug=true / false
					// vault=true (omit if false, do not use vault=false which throws an error)
					// buyerCountry: "NL"							// NOTE PayPal Sandbox only - throws error when fetching URL with buyer-country=XX for production https://developer.paypal.com/docs/checkout/reference/customize-sdk/#buyer-country
				});
			});
			document.getElementById("orchestration-button-load-paypal-sdk-script").addEventListener('click', app.paypal.loadSDKScriptDefault);
			app.paypal.onSDKLoaded = _ => { let f = "app.paypal.loadSDKScript"; console.log(f + ": PayPal SDK loaded", {paypalVersion: paypal.version, hostedFieldsIsEligible: paypal.HostedFields.isEligible()}); };





			app.paypal.renderPaymentArea = _ => {
				let f = "app.paypal.renderPaymentArea";

				if (app.paypal.paymentAreaRendered) {
					console.log(f + "PayPal SDK was already rendered. Aborting.", {"app.paypal.paymentAreaRendered": app.paypal.paymentAreaRendered});
					return false;
				}

				if (typeof paypal === "undefined") {
					console.warn(f + ": The 'paypal' data object is not defined. Load the PayPal SDK first.");
					return false;
				}

				paypal.Buttons({
					style: {					// NOTE		https://developer.paypal.com/docs/checkout/integration-features/customize-button/
						layout:		'vertical',	// VALUES	vertical horizontal // NOTE 'vertical' is recommended as 'horizontal' doesn't show Alternative Payment Buttons immediately, e.g. iDEAL, giropay, bancontact.
						color:		'blue',		// VALUES	gold, blue, silver, black, white
						shape:		'rect',		// VALUES	rect pill
						label:		'paypal',	// VALUES	paypal checkout pay installment
						height:		50,			// VALUES	25 - 55
						period:		12,			// VALUES	for BR: 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 --- for en_MX, MX: 3, 6, 9, 12
						tagline:	false		// VALUES	true false
					},

					onInit: function (data, actions) {
      					actions.disable();		// NOTE disables the Payment SDK's buttons so you can activate them from an outside event, e.g. after the user has agreed to your T&Cs

						app.paypal.SDKButtonActions = actions;

						console.log("paypalSDK.onInit: Finished initialization");
					},

					onClick: function(data, actions) {			// NOTE (1) When user clicks on a PayPal SDK button (allows rejection)
						let f = 'paypalSDK.onClick';
						console.log(f + "User clicked on payment option inside the PayPal Payment Area.", {data: data, actions: actions});

						if (true) {							// NOTE Show a validation error if any of your preconditions is not yet met, e.g. customer to agree to T&Cs.
							return actions.resolve();
						} else {
							return actions.reject();
						}
					},

					createOrder: function (data, actions) {		// NOTE (2) Continue with Order by returning an Order ID (unless onClick wasn't rejected)
						let f = 'paypalSDK.createOrder';
						console.log(f + ": Order Id passed to PayPal SDK", {data: data, actions: actions});
						return (app.paypal.orderId);
					},

					onApprove: function (data, actions) {		// NOTE (3a) After PayPal Checkout Flow, in case consumer paid successfully
						let f = 'paypalSDK.onApprove';
						console.log(f + ": Consumer agreed to purchase on PayPal Checkout Flow. Ready to capture the order.");
						//actions.restart();

						// if automatically: app.paypalOrderCapture();
						// TODO fetch /paypal-order-capture

						// In some cases, PayPal will return checkout successfully (!) but return 'INSTRUMENT_DECLINED' when capturing the order, meaning the chosen credit card wasn't good for payment. In that case, manually restart the checkout as below:
						// return fetch('/my-server/capture-paypal-transaction', {
						// 	headers: {
						// 		'content-type': 'application/json'
						// 	},
						// 	body: JSON.stringify({
						// 		orderID: data.orderID
						// 	})
						// })
						// .then(function(res) { return res.json(); })
						// .then(function(details) {
						// 	if (details.error === 'INSTRUMENT_DECLINED') {
						// 		return actions.restart();
						// 	}
						// });
					},

					onCancel: function () {						// NOTE (3b) After PayPal Checkout Flow, in case consumer pressed 'Cancel'. In case customer wants to try PayPal again, you do NOT need to fetch a new Order ID - the old one is still good.
						let f = 'paypalSDK.onCancel';
						console.log(f + ": Consumer canceled the PayPal Checkout Flow.");
					},

					onError: function (error) {					// NOTE (3c) After PayPal Checkout Flow, in case there was an error
						let f = 'paypalSDK.onError';
						console.log(f + ": A technical error occured during the PayPal Checkout Flow.", {error: error});
					}

				}).render("#paypal-sdk-container");

				app.paypalSDKrendered = true;

				console.log(f + ": PayPal SDK render() was called.", { "app.paypal.paymentAreaRendered": app.paypal.paymentAreaRendered , paypal: paypal });
			};
			document.getElementById("orchestration-button-render-paypal-sdk").addEventListener('click', app.paypal.renderPaymentArea);



			//// PayPal Redirect URL
			// https://www.paypal.com/checkoutnow?
			// fundingSource=paypal
			// &locale.x=en_DE
			// &commit=true
			// &clientID=AVX6tQmhr7LIZfYA0HBVAn9RpmPB88Mcz_ozS73farX-5e4W3FdY0P4fOwkhgadI99788JdGnpjKjLf_
			// &sessionID=cfa6dbd497_mtk6mzq6mtm
			// &buttonSessionID=d93a122f1f_mtk6mzq6mji
			// &env=production
			// &sdkMeta=eyJ1cmwiOiJodHRwczovL3d3dy5wYXlwYWwuY29tL3Nkay9qcz9jbGllbnQtaWQ9QVZYNnRRbWhyN0xJWmZZQTBIQlZBbjlScG1QQjg4TWN6X296UzczZmFyWC01ZTRXM0ZkWTBQNGZPd2toZ2FkSTk5Nzg4SmRHbnBqS2pMZl8mbWVyY2hhbnQtaWQ9TkJFUlYzOFFQOFI1USZjdXJyZW5jeT1FVVImaW50ZW50PWNhcHR1cmUmY29tbWl0PXRydWUmY29tcG9uZW50cz1idXR0b25zLGhvc3RlZC1maWVsZHMmbG9jYWxlPWVuX0RFIiwic3RhZ2VIb3N0Ijoid3d3LnBheXBhbC5jb20iLCJhcGlTdGFnZUhvc3QiOiJtc21hc3Rlci5xYS5wYXlwYWwuY29tIn0=
			// // {"url":"https://www.paypal.com/sdk/js?client-id=AVX6tQmhr7LIZfYA0HBVAn9RpmPB88Mcz_ozS73farX-5e4W3FdY0P4fOwkhgadI99788JdGnpjKjLf_&merchant-id=NBERV38QP8R5Q&currency=EUR&intent=capture&commit=true&components=buttons,hosted-fields&locale=en_DE","stageHost":"www.paypal.com","apiStageHost":"msmaster.qa.paypal.com"}
			// &xcomponent=1
			// &version=5
			// &token=32J141037J211092T

			//// PayPal Credit Redirect URL
			// https://www.paypal.com/checkoutnow
			// ?fundingSource=credit
			// &locale.x=en_DE
			// &commit=true&clientID=AVX6tQmhr7LIZfYA0HBVAn9RpmPB88Mcz_ozS73farX-5e4W3FdY0P4fOwkhgadI99788JdGnpjKjLf_&sessionID=cfa6dbd497_mtk6mzq6mtm&buttonSessionID=d93a122f1f_mtk6mzq6mji&env=production&sdkMeta=eyJ1cmwiOiJodHRwczovL3d3dy5wYXlwYWwuY29tL3Nkay9qcz9jbGllbnQtaWQ9QVZYNnRRbWhyN0xJWmZZQTBIQlZBbjlScG1QQjg4TWN6X296UzczZmFyWC01ZTRXM0ZkWTBQNGZPd2toZ2FkSTk5Nzg4SmRHbnBqS2pMZl8mbWVyY2hhbnQtaWQ9TkJFUlYzOFFQOFI1USZjdXJyZW5jeT1FVVImaW50ZW50PWNhcHR1cmUmY29tbWl0PXRydWUmY29tcG9uZW50cz1idXR0b25zLGhvc3RlZC1maWVsZHMmbG9jYWxlPWVuX0RFIiwic3RhZ2VIb3N0Ijoid3d3LnBheXBhbC5jb20iLCJhcGlTdGFnZUhvc3QiOiJtc21hc3Rlci5xYS5wYXlwYWwuY29tIn0=&xcomponent=1&version=5&token=32J141037J211092T#/checkout/genericError?code=BLOCK_PPC_INELIGIBLE_USER

			app.paypal.renderUCCArea = _ => {
				let f = "app.paypal.renderUCCArea";

				if (paypal.HostedFields.isEligible()) {
					paypal.HostedFields.render({	// NOTE Rendering/Styling Options
						createOrder: function () {
							console.log(f + ": Passed Order ID to PayPal SDK in 'createOrder()'.");
							return (app.orderId);
						},

						fields: {
							number: {
								selector:				'#paypal-ucc-card-number',
								placeholder:			'Credit Card Number'
							},
							expirationDate: {
								selector:				'#paypal-ucc-expiration-date',
								placeholder:			'MM/YYYY'
							},
							cvv: {
								selector:				'#paypal-ucc-cvv',
								placeholder:			'CVV'
							}
						},

						styles: {
							'input': {
								'color':				'black',
								'font-family':			'"Helvetica Neue", sans-serif',
								'font-size':			'12px',
								'transition':			'color 160ms linear',
								'-webkit-transition':	'color 160ms linear'
							},
							':focus': {
								'color':				'black'
							},
							'.invalid': {
								'color':				'tomato'
							}
						}

						// NOTE allowed styles
						// appearance
						// color
						// direction
						// font-family
						// font-size-adjustfont-size
						// font-stretch
						// font-style font-variant-alternates
						// font-variant-capsfont-variant-east-asian
						// font-variant-ligatures font-variant-numeric
						// font-variantfont-weight
						// font
						// letter-spacing
						// line-height
						// opacity
						// outline
						// padding
						// text-shadowtransition
						// -moz-appearance
						// -moz-osx-font-smoothing
						// -moz-tap-highlight-color
						// -moz-transition
						// -webkit-appearance
						// -webkit-font-smoothing
						// -webkit-tap-highlight-color
						// -webkit-transition
					})
					.then(function (hostedFieldsInstance) {									// NOTE	Callback for when PayPal UCC was successfully loaded, yielding a 'hostedFieldsInstance'. Allows to set more advanced event handlers since now there are DOM nodes to attach them to.

						//////////////////////////////////////////////////////////
						// PayPal UCC Event Handlers (for more advanced styling)

						hostedFieldsInstance.on('focus', function (e) {						// NOTE when #ucc-card-number, #ucc-expiration-date, #ucc-cvv gain focus
							console.log(f, 'UCC Event "focus"', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), event: e, app: app});
						});

						hostedFieldsInstance.on('blur', function (e) {						// NOTE when #ucc-card-number, #ucc-expiration-date, #ucc-cvv lose focus
							console.log(f, 'UCC Event "blur"', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), event: e, app: app});
						});

						hostedFieldsInstance.on('notEmpty', function (e) {					// NOTE when user enters information into #ucc-card-number, #ucc-expiration-date, or #ucc-cvv when nothing was in there before
							console.log(f, 'UCC Event "notEmpty"', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), event: e, app: app});
						});

						hostedFieldsInstance.on('empty', function (e) {						// NOTE when user emptied #ucc-card-number, #ucc-expiration-date, or #ucc-cvv
							console.log(f, 'UCC Event "empty"', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), event: e, app: app});
						});

						hostedFieldsInstance.on('cardTypeChange', function (e) {			// NOTE when user changes first numbers in #ucc-card-number, e.g. changing from 4*** (Visa) to 5*** (Mastercard)
							let f = 'hostedFieldsInstance.on("cardTypeChange")';
							console.log(f, 'UCC Event "cardTypeChange"', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), fields: e.fields, emittedBy: e.emittedBy, cards: e.cards, app: app});

							if (e.cards.length === 1) {
								console.log(f, 'UCC Card Type changed to "' + e.cards[0].type + '"');
							} else {
								console.log(f, 'UCC Card Type unknown');
							}
							// Card Types
							// american- express
							// diners-club - discover
							// jcb
							// maestro
							// master-card - unionpay
							// visa
						});

						hostedFieldsInstance.on('validityChange', function (e) {			// NOTE when validity of #ucc-card-number, #ucc-expiration-date, or #ucc-cvv change from valid to invalid or vice versa
							let emittingField = e.fields[e.emittedBy];
							let emittingFieldIsValid = emittingField.isValid;
							let emittingFieldIsPotentiallyValid = emittingField.isPotentiallyValid;

							console.log(f, 'UCC Event "validityChange"', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), fields: e.fields, emittedBy: e.emittedBy, emittingField: emittingField, 'emittingFieldIsValid': emittingFieldIsValid, 'emittingFieldIsPotentiallyValid': emittingFieldIsPotentiallyValid, event: e, app: app});
						});

						hostedFieldsInstance.on('inputSubmitRequest', function (e) {		// NOTE when user presses [Enter / Return] to submit the form field => recommendation: submit entire form
							console.log(f, 'UCC Event "inputSubmitRequest"', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), event: e, app: app});

							app.submitPayPalUCC(e, hostedFieldsInstance);
						});

						////////////////////////////////////////////////////////////////////////////////////////////
						// Set event handler on form submission of your PayPal UCC form, i.e. '#paypal-ucc-form'

						document.getElementById("paypal-ucc-form").addEventListener('submit', app.paypal.submitUCC);

						console.log("app.paypal.renderUCCArea: Event Handlers added within .render().then().");
					});
				}
				else {
					console.log(f, 'Merchant ineligible for UCC. Not rendering UCC area.', {'paypal.HostedFields.isEligible()': paypal.HostedFields.isEligible(), orderId: app.orderId, app: app});
					// TODO Optionally hide Hosted Fields area (or do not show to begin with, of course)
				}
			};
			document.getElementById("orchestration-button-render-paypal-ucc").addEventListener('click', app.paypal.renderUCCArea);



			app.paypal.submitUCC = function (event, hostedFieldsInstance) {
				let f = "app.submitPayPalUCC";

				if (typeof event.preventDefault === 'function') {
					event.preventDefault();		// NOTE Prevents browser from refreshing the page because it thinks this is an old-timey form with GET /myURL/?
				}

				console.log(f, 'PayPal UCC submitting ...', {'hostedFieldsInstance.getState()': hostedFieldsInstance.getState(), event: event, app: app});

				hostedFieldsInstance.submit({contingencies: ['3D_SECURE']})	// NOTE When user submits the '#paypal-ucc-form' form, invoke the 'hostedFieldsInstance' 'submit()' function
				.then(function (paypalUCCPayload) {			// NOTE Callback after successful submission which attached the credit card information to the previously created PayPal Order ID.
					console.log(f, 'PayPal UCC submitted', {liabilityShifted: paypalUCCPayload.liabilityShifted, paypalUCCPayload: paypalUCCPayload, app: app});		// SAMPLE paypalUCCPayload = {orderId: ..., liabilityShifted: undefined/true/false}

					if (typeof paypalUCCPayload.liabilityShifted === 'undefined') {		// NOTE Either `{contingencies: ['3D_SECURE']}` was not specified above or customer's credit card is not enrolled with 3D Secure. Proceed at your own discretion and risk!
						app.paypalOrderCapture();
					}
					else if (paypalUCCPayload.liabilityShifted === false) {				// NOTE Consumer's credit card is enrolled with 3D Secure but consumer cancelled or failed the 3D Secure check. Proceed at your own discretion and risk!
					}
					else if (paypalUCCPayload.liabilityShifted === true) {				// NOTE Consumer's credit card is enrolled with 3D Secure and consumer succeeded with 3D Secure check. Chargeback liability was successfully shifted from
						app.paypalOrderCapture();
					}
				})
				.catch(function (error) {
					console.log(f, 'PayPal UCC submission failed', {error: error, app: app});
					// error: {code: 'error', description: 'error'}						// NOTE Consumer cancels 3D Secure flow within online banking app. Conflicts with above options.
				});
			};



			app.paypal.activatePaymentButtons = _ => {
				let f = "app.paypal.activatePaymentButtons";
				app.paypal.SDKButtonActions.enable();
				console.log(f + ": PayPal Payment Buttons activated", {'app.paypal.SDKButtonActions': app.paypal.SDKButtonActions, app: app});
			};
			document.getElementById("orchestration-button-activate-paypal-buttons").addEventListener('click', app.paypal.activatePaymentButtons);




			app.paypal.orderCapture = async _ => {
				let f = "app.paypal.orderCapture";
				console.log(f + ": Capturing order (" + app.paypal.orderId + ") ...");

				try {
					let x = await fetch("https://xanderia.one/paypal-order-capture?orderId=" + app.paypal.orderId);
					let xj = await x.json();

					console.log(f + ": Capturing Order succeeded.", {response: xj});
				} catch (error) {
					console.log(f + ": Failed to capture the order.", {orderId: app.paypal.orderId, error: error});
				};
			};
			document.getElementById("orchestration-button-finalize-order").addEventListener('click', app.paypal.orderCapture);



			app.paypal.orderRefund = _ => {
				let f = "app.paypal.orderRefund";
				console.log(f + ": Not implemented yet.");
			};
			// document.getElementById("orchestration-button-refund-capture").addEventListener('click', app.paypal.orderRefund);



			app.paypal.loadPayPalAutomatically = _ => {
				let f = 'app.loadPayPalAutomatically()';
				console.log(f, ": started");

				// TODO Timing

				// 1 Client Token + 2 Order
				// 3 Load SDK
				// 4 Render SDK + 5 Render UCC
				// 6 Activate Buttons
			};



			console.log("app: Started");

		--></script>

		<div id="paypal-sdk-script-container"></div>

	</body>
</html>
